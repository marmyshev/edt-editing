<?xml version="1.0" encoding="UTF-8"?>
<project
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
	xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<modelVersion>4.0.0</modelVersion>
	<groupId>org.mard.dt.editing</groupId>
	<artifactId>build</artifactId>
	<version>0.6.0-SNAPSHOT</version>
	<name>Disable Editing plugin for 1C:EDT</name>
	<packaging>pom</packaging>

	<prerequisites>
		<maven>3.9.4</maven>
	</prerequisites>

	<scm>
		<connection>scm:git:git@gitlab.com:marmyshev/edt-editing.git</connection>
	</scm>

	<properties>
		<name>Disable Editing plugin for 1C:EDT</name>
		<maven.compiler.source>17</maven.compiler.source>
		<maven.compiler.target>17</maven.compiler.target>
		<maven.compiler.release>17</maven.compiler.release>
		<tycho.version>4.0.5</tycho.version>
		<tycho.extras.version>4.0.5</tycho.extras.version>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
		<maven.build.timestamp.format>yyyyMMdd-HHmm</maven.build.timestamp.format>
		<qualifier>${maven.build.timestamp}</qualifier>
		<!-- Sonar -->
		<!-- The destination file for the code coverage report has to be set to 
			the same value in the parent pom and in each module pom. Then JaCoCo will 
			add up information in the same report, so that, it will give the cross-module 
			code coverage. -->
		<sonar.jacoco.itReportPath>${project.basedir}/../repository/target/jacoco-merged.exec</sonar.jacoco.itReportPath>
		<sonar.scanner.version>3.7.0.1746</sonar.scanner.version>
		<org.jacoco.version>0.8.5</org.jacoco.version>
		<aspectj.version>1.9.2</aspectj.version>
		<allure.junit.version>2.12.1</allure.junit.version>
		<allure.maven.version>2.10.0</allure.maven.version>
	</properties>

	<profiles>
		<profile>
			<id>build</id>

			<modules>
				<module>../org.mard.dt.editing.target</module>
				<module>../org.mard.dt.editing</module>
				<module>../org.mard.dt.editing.ui</module>
			</modules>
		</profile>
		<profile>
			<id>sign</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.eclipse.cbi.maven.plugins</groupId>
						<artifactId>eclipse-jarsigner-plugin</artifactId>
						<version>${eclipse.jarsigner.plugin.version}</version>
						<executions>
							<execution>
								<id>sign</id>
								<phase>package</phase>
								<goals>
									<goal>sign</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<signerUrl>${singer.sign.url}/jarsign.php</signerUrl>
							<excludeInnerJars>true</excludeInnerJars>
							<retryLimit>5</retryLimit>
							<fork>true</fork>
							<systemPropertyVariables>
								<signer.ssl.keyStore>${env.SIGN_KEYSTORE_PATH}</signer.ssl.keyStore>
								<signer.ssl.keyStorePassword>${env.SIGN_KEYSTORE_PASSWORD}</signer.ssl.keyStorePassword>
							</systemPropertyVariables>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>site</id>

			<modules>
				<module>../org.mard.dt.editing.feature</module>
				<module>../org.mard.dt.editing.repository</module>
			</modules>
		</profile>
		<profile>
			<!-- Profile to run JUnit-tests -->
			<id>tests</id>

			<modules>
				<module>../tests/units/</module>
			</modules>
		</profile>
		<profile>
			<!-- Profile to run Sonar scanner in Integration tests -->
			<id>sonar</id>

			<modules>
				<module>../tests/itests/</module>
			</modules>
		</profile>
	</profiles>

	<dependencies>
		<dependency>
			<groupId>org.aspectj</groupId>
			<artifactId>aspectjrt</artifactId>
			<version>${aspectj.version}</version>
		</dependency>
		<dependency>
			<groupId>io.qameta.allure</groupId>
			<artifactId>allure-junit4</artifactId>
			<version>${allure.junit.version}</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.aspectj</groupId>
			<artifactId>aspectjweaver</artifactId>
			<version>${aspectj.version}</version>
		</dependency>
	</dependencies>

	<build>
		<sourceDirectory>src</sourceDirectory>
		<plugins>
			<plugin>
				<groupId>org.eclipse.tycho</groupId>
				<artifactId>tycho-maven-plugin</artifactId>
				<version>${tycho.version}</version>
				<extensions>true</extensions>
			</plugin>
			<plugin>
				<groupId>org.eclipse.tycho</groupId>
				<artifactId>target-platform-configuration</artifactId>
				<version>${tycho.version}</version>
				<configuration>
					<resolver>p2</resolver>
					<executionEnvironment>JavaSE-17</executionEnvironment>
					<includePackedArtifacts>true</includePackedArtifacts>
					<target>
						<artifact>
							<groupId>org.mard.dt.editing.target</groupId>
							<artifactId>default</artifactId>
							<version>0.6.0-SNAPSHOT</version>
						</artifact>
					</target>
					<environments>
						<environment>
							<os>win32</os>
							<ws>win32</ws>
							<arch>x86_64</arch>
						</environment>
						<environment>
							<os>linux</os>
							<ws>gtk</ws>
							<arch>x86_64</arch>
						</environment>
						<environment>
							<os>macosx</os>
							<ws>cocoa</ws>
							<arch>x86_64</arch>
						</environment>
					</environments>
                    <dependency-resolution>
                        <extraRequirements>
                            <requirement>
                                <type>eclipse-plugin</type>
                                <id>org.apache.felix.scr</id>
                                <versionRange>0.0.0</versionRange>
                            </requirement>
                            <requirement>
                                <type>eclipse-plugin</type>
                                <id>org.apache.aries.spifly.dynamic.bundle</id>
                                <versionRange>0.0.0</versionRange>
                            </requirement>
                        </extraRequirements>
                    </dependency-resolution>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.eclipse.tycho</groupId>
				<artifactId>tycho-source-plugin</artifactId>
				<version>${tycho.version}</version>
				<configuration>
					<archive>
						<addMavenDescriptor>false</addMavenDescriptor>
					</archive>
				</configuration>
				<executions>
					<execution>
						<goals>
							<goal>plugin-source</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-clean-plugin</artifactId>
				<version>2.4.1</version>
				<configuration>
					<filesets>
						<fileset>
							<directory>xtend-gen</directory>
							<includes>
								<include>**/*</include>
							</includes>
							<excludes>
								<exclude>.gitignore</exclude>
							</excludes>
							<followSymlinks>false</followSymlinks>
						</fileset>
					</filesets>
				</configuration>
			</plugin>
			<plugin>
			    <!-- see https://github.com/mojohaus/aspectj-maven-plugin/pull/45 -->
				<groupId>com.nickwongdev</groupId>
				<artifactId>aspectj-maven-plugin</artifactId>
				<version>1.12.1</version>
				<configuration>
					<source>11</source>
					<target>11</target>
					<complianceLevel>11</complianceLevel>
					<aspectDirectory>src</aspectDirectory>
				</configuration>
			</plugin>
			<plugin>
				<groupId>io.qameta.allure</groupId>
				<artifactId>allure-maven</artifactId>
				<version>${allure.maven.version}</version>
			</plugin>
		</plugins>
		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.eclipse.tycho</groupId>
					<artifactId>tycho-compiler-plugin</artifactId>
					<version>${tycho.version}</version>
					<configuration>
						<encoding>UTF-8</encoding>
						<strictCompilerTarget>true</strictCompilerTarget>
						<useProjectSettings>true</useProjectSettings>
						<showWarnings>true</showWarnings>
						<showDeprecation>true</showDeprecation>
						<verbose>true</verbose>
						<excludeResources>
							<exludeResource>**/*.aj</exludeResource>
						</excludeResources>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.eclipse.tycho</groupId>
					<artifactId>tycho-packaging-plugin</artifactId>
					<version>${tycho.version}</version>
					<configuration>
						<forceContextQualifier>${qualifier}</forceContextQualifier>
						<archive>
							<addMavenDescriptor>false</addMavenDescriptor>
						</archive>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.eclipse.tycho</groupId>
					<artifactId>tycho-p2-plugin</artifactId>
					<version>${tycho.version}</version>
				</plugin>
				<plugin>
					<groupId>org.eclipse.tycho</groupId>
					<artifactId>tycho-p2-repository-plugin</artifactId>
					<version>${tycho.version}</version>
					<configuration>
						<repositoryName>Disable Editing plugin ${qualifier}</repositoryName>
						<compress>false</compress>
						<xzCompress>false</xzCompress>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.eclipse.tycho.extras</groupId>
					<artifactId>tycho-eclipserun-plugin</artifactId>
					<version>${tycho.extras.version}</version>
				</plugin>
				<plugin>
					<groupId>org.sonarsource.scanner.maven</groupId>
					<artifactId>sonar-maven-plugin</artifactId>
					<version>${sonar.scanner.version}</version>
				</plugin>
			</plugins>
		</pluginManagement>
	</build>
	<pluginRepositories>
		<pluginRepository>
			<id>eclipse-jarsigner-snapshots</id>
			<name>Eclipse-JarSigner Maven Snapshots repository</name>
			<url>${eclipse-jarsigner-snapshots}</url>
		</pluginRepository>
	</pluginRepositories>
</project>
